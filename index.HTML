<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒ¡å¥³å£«Â·è´¢å¯Œç®¡å®¶æ¥ç¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --gold: #f6e05e; --red: #ff4d4f; --green: #52c41a; }
        body { background: #080000; color: #fdf2f2; font-family: "PingFang SC", "Microsoft YaHei", sans-serif; margin: 0; overflow: hidden; }
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .gold-text {
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-size: 200% auto; animation: shine 5s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }
        .main-container { position: relative; z-index: 10; width: 100%; max-width: 850px; margin: 0 auto; }
        .premium-card {
            background: rgba(18, 18, 18, 0.9);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(191, 149, 63, 0.5);
            box-shadow: 0 30px 100px rgba(0,0,0,1);
        }
        /* å¢åŠ æ“ä½œå¡ç‰‡çš„è§†è§‰åŒºåˆ† */
        .action-box { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 15px; margin: 10px 0; border: 1px dashed rgba(191,149,63,0.3); }
        .bubble-ai { background: rgba(40, 40, 40, 0.95); border-left: 6px solid #bf953f; border-radius: 4px 24px 24px 24px; }
        .bubble-user { background: linear-gradient(135deg, #b91c1c 0%, #7f1d1d 100%); border-radius: 24px 24px 4px 24px; }
        .scrolling-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(40, 0, 0, 0.9);
            border-top: 1px solid rgba(191, 149, 63, 0.5); overflow: hidden; white-space: nowrap; padding: 15px 0; z-index: 100;
        }
        .scroll-content { display: inline-block; animation: scroll-left 45s linear infinite; font-size: 1.1rem; color: #fef08a; }
        @keyframes scroll-left { from { transform: translateX(100%); } to { transform: translateX(-100%); } }
        #chat-box::-webkit-scrollbar { width: 6px; }
        #chat-box::-webkit-scrollbar-thumb { background: #bf953f; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col p-4">

    <div id="canvas-container"></div>

    <header class="text-center mb-6 relative z-10 pt-4">
        <h1 class="text-5xl font-black gold-text mb-2">âœ¨ å°Šæ•¬çš„èƒ¡å¥³å£« âœ¨</h1>
        <p class="text-red-500 font-bold tracking-[0.5em] text-sm md:text-base">æ‚¨çš„æœ¬é‡‘ï¼Œæ¥ç¦å®ˆæŠ¤ ğŸ’° æ‚¨çš„è´¢å¯Œï¼Œæ¥ç¦åŠ©æ”»</p>
    </header>

    <div class="main-container flex-1 mb-28">
        <div class="premium-card rounded-[2.5rem] flex flex-col h-[70vh] overflow-hidden">
            <div id="chat-box" class="flex-1 overflow-y-auto p-6 space-y-6">
                <div class="flex justify-start">
                    <div class="bubble-ai p-6 max-w-[95%] shadow-2xl">
                        <p class="text-yellow-500 text-lg font-bold mb-3">ğŸ¶ æ‹›è´¢æ¥ç¦ï¼š</p>
                        <div class="markdown-content">
                            èƒ¡å¦ˆå¦ˆå¥½ï¼æ¥ç¦å·²ç»è¹²åœ¨é‡‘åº“é—¨å£å¸®æ‚¨çœ‹ç›˜äº†ã€‚ğŸ§§<br><br>
                            è¯·å‘Šè¯‰æˆ‘è‚¡ç¥¨ä»£ç ï¼Œæ¥ç¦ä¼šä¸¥æ ¼æŒ‰ç…§â€œæœ¬é‡‘ç¬¬ä¸€â€çš„å¿ƒæ³•ä¸ºæ‚¨è¯Šæ–­ï¼
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-6 bg-black/60 border-t border-yellow-900/40">
                <div class="flex gap-3">
                    <input id="user-input" type="text" 
                        class="flex-1 bg-zinc-900 border-2 border-zinc-700 rounded-2xl px-5 py-4 text-white text-lg focus:outline-none focus:border-yellow-600 transition-all"
                        placeholder="è¯·è¾“å…¥6ä½ä»£ç ..."
                        onkeydown="if(event.keyCode==13) askAI()">
                    <button onclick="askAI()" 
                        class="bg-gradient-to-r from-yellow-700 to-yellow-500 text-black px-8 py-4 rounded-2xl font-black text-lg active:scale-95 transition-all">
                        è¯·æ¥ç¦è¯Šæ–­
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="scrolling-footer">
        <div class="scroll-content">
            ğŸŒ¸ ç¥å¦ˆå¦ˆï¼šçœ¼å…‰ç‹¬åˆ°ã€å²å²å¹³å®‰ ğŸŒ¸ ğŸ§§ æ„¿èƒ¡å¥³å£«ï¼šè´¦æˆ·æ—¥æ—¥çº¢ã€å¿ƒæ€æ­¥æ­¥é«˜ ğŸ§§ âœ¨ å¥³å„¿æ—æºªä¸ºæ‚¨ç¥ˆç¦ï¼šå¥åº·é•¿å¯¿ã€ç¬‘å£å¸¸å¼€ âœ¨ ğŸ’° ç¨³å¥æŠ•èµ„æ˜¯ç¦æ°”ï¼Œæ¥ç¦é™ªæ‚¨æ…¢æ…¢å˜å¯Œ ğŸ’°
        </div>
    </div>

    <script>
        // 3DèƒŒæ™¯
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        const particles = new THREE.Points(new THREE.BufferGeometry().setAttribute('position', new THREE.BufferAttribute(new Float32Array(2000*3).map(()=>(Math.random()-0.5)*1200), 3)), new THREE.PointsMaterial({size:3, color:0xbf953f, transparent:true, opacity:0.6}));
        scene.add(particles); camera.position.z = 500;
        function animate() { requestAnimationFrame(animate); particles.rotation.y += 0.0007; renderer.render(scene, camera); }
        animate();

        // æ ¸å¿ƒé€»è¾‘
        const API_KEY = 'sk-fd4dfa38dfd346e38706239f60a3f6ae';

        async function getRealtimeStock(code) {
            return new Promise((resolve) => {
                const fullCode = (code.startsWith('6') || code.startsWith('9') ? 'sh' : 'sz') + code;
                const script = document.createElement('script');
                script.src = `https://qt.gtimg.cn/q=${fullCode}`;
                script.onload = () => {
                    const data = window['v_' + fullCode];
                    if (data) {
                        const p = data.split('~');
                        resolve({ name: p[1], price: parseFloat(p[3]), change: parseFloat(p[32]) });
                    } else resolve(null);
                    document.body.removeChild(script);
                };
                script.onerror = () => resolve(null);
                document.body.appendChild(script);
            });
        }

        async function askAI() {
            const input = document.getElementById('user-input');
            const code = input.value.trim();
            if (!/^\d{6}$/.test(code)) return alert("èƒ¡å¥³å£«ï¼Œä»£ç éœ€è¦æ˜¯6ä½æ•°å­—å“¦~");

            appendMessage('user', `æ¥ç¦ï¼Œå¸®æˆ‘ä»”ç»†æŸ¥æŸ¥è¿™åªç¥¨ï¼š${code}`);
            input.value = '';
            const loadingId = appendMessage('assistant', 'æ¥ç¦æ­£åœ¨è®¡ç®—ç‚¹ä½ã€è§‚å¯Ÿåº„å®¶åŠ¨å‘ï¼Œè¯·ç¨ç­‰ç‰‡åˆ»...');

            const stock = await getRealtimeStock(code);
            if (!stock) { document.getElementById(loadingId).innerHTML = "èƒ¡å¥³å£«ï¼Œæ‰¾ä¸åˆ°è¿™ä¸ªä»£ç ï¼Œè¯·æ ¸å¯¹ã€‚"; return; }

            const SYSTEM_PROMPT = `
            ä½ æ˜¯ç”±å¥³å„¿æ—æºªå®šåˆ¶çš„è´¢å¯Œç®¡å®¶â€œæ¥ç¦â€ã€‚ä½ çš„ä»»åŠ¡æ˜¯ä¿æŠ¤èƒ¡å¥³å£«çš„æœ¬é‡‘ã€‚
            
            ### ä¸¥æ ¼è§„åˆ™ï¼š
            1. **åˆ¤æ–­ä¾æ®**ï¼šå¿…é¡»åˆ†æç°ä»·(${stock.price})ä¸"ç”Ÿå‘½çº¿"(å‡çº¿)çš„å…³ç³»ï¼Œåˆ¤æ–­"äººæ°”"(æˆäº¤é‡)æ˜¯èç¼©è¿˜æ˜¯æ”¾é‡ã€‚
            2. **äº”æ˜Ÿè¯„çº§**ï¼š
               - â­â­â­â­â­ (5æ˜Ÿ): å¿…é¡»è¦ä¹°ï¼
               - â­â­â­â­ (4æ˜Ÿ): å€¼å¾—å›¤ç‚¹ã€‚
               - â­â­â­ (3æ˜Ÿ): çœ‹ç€ä¸åŠ¨ã€‚
               - â­â­ (2æ˜Ÿ): èµ¶ç´§æ”¶è¡£æœ(å‡ä»“)ã€‚
               - â­ (1æ˜Ÿ): åƒä¸‡åˆ«å»(é£é™©)ã€‚
            3. **æ“ä½œç‚¹ä½(å¿…é¡»ç»™æ•°å­—)**ï¼š
               - ğŸŸ¢ å»ºè®®ä¹°ç‚¹ï¼šç»™å‡ºå…·ä½“çš„ä¹°å…¥ä»·æ ¼åŒºé—´ï¼ˆå‚è€ƒç°ä»·ä¸‹æµ®2%-3%æˆ–æ”¯æ’‘ä½ï¼‰ã€‚
               - ğŸ”´ æ­¢ç›ˆç›®æ ‡ï¼šç»™å‡ºå…·ä½“çš„å–å‡ºç›®æ ‡ä»·æ ¼ï¼ˆå‚è€ƒè¿‘æœŸé˜»åŠ›ä½ï¼‰ã€‚
               - ğŸ›¡ï¸ æ­¢æŸé˜²å®ˆï¼šç»™å‡ºå…·ä½“çš„ç¦»åœºä»·æ ¼ï¼ˆå¿…é¡»ä½äºç°ä»·ï¼Œæœ¬é‡‘åº•çº¿ï¼‰ã€‚

            ### è¾“å‡ºæ¨¡æ¿ï¼š
            ### ğŸ¶ æ¥ç¦Â·æ±‡æŠ¥ï¼š${stock.name} (${code})
            **ğŸŒŸ è´¢å¯Œç­‰çº§ï¼š** [æ˜Ÿçº§] - **[è¯„ä»·]**
            ---
            #### ğŸ“Š æ¥ç¦çœ‹ç›˜
            * **ç°ä»·ï¼š** ${stock.price} ([æ¶¨è·Œå¹…]%)
            * **ç®¡å®¶çš„è¯ï¼š** (ç”¨é€šä¿—è¯­è¨€è¯Šæ–­ï¼šä¸»åŠ›åœ¨ä¹°è¿˜æ˜¯è·‘ï¼Ÿäººæ°”æ—ºä¸æ—ºï¼Ÿ50å­—ä»¥å†…)
            ---
            #### ğŸ§§ æ“ä½œå»ºè®® (Action Plan)
            * **ğŸ“ ç»¼åˆå†³ç­–ï¼š** **[ä¹°å…¥ / è§‚æœ› / å‡ä»“ / æ­¢æŸ]**
            * **ğŸŸ¢ ğŸŸ¢ åˆ’ç®—ä¹°ç‚¹ï¼š[ä»·æ ¼åŒºé—´]** (åœ¨æ­¤å¤„åŸ‹ä¼æœ€çœé’±)
            * **ğŸ”´ ğŸ”´ èµšé’±ç›®æ ‡ï¼š[å…·ä½“ä»·æ ¼]** (åˆ°äº†è¿™é‡Œå’±ä»¬å°±æ”¶ç±³å–èŒ¶)
            * **ğŸ›¡ï¸ ğŸ›¡ï¸ å®‰å…¨åº•çº¿ï¼š[å…·ä½“ä»·æ ¼]** (è·Œç ´è¿™ä¸ªæ•°ï¼Œæ¥ç¦ä¼šå«æ‚¨æ’¤é€€)
            ---
            #### ğŸŒ¹ æ¥ç¦Â·è´´å¿ƒè¯
            (ä»¥â€œå°Šæ•¬çš„èƒ¡å¥³å£«â€å¼€å¤´ï¼Œç»“åˆèƒ¡å¥³å£«å·±åœŸå‘½æ ¼çš„ç¨³å¥å’Œåšå¾·ï¼Œé€ä¸Šä¸€å¥èº«ä½“å¥åº·æˆ–å¿ƒæ€æ–¹é¢çš„å…³æ€€ï¼Œ50-70å­—ã€‚)
            `;

            try {
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "system", content: SYSTEM_PROMPT }, { role: "user", content: `è¯·é’ˆå¯¹${stock.name}ç»™å‡ºå…·ä½“çš„æ“ä½œç‚¹ä½ã€‚` }],
                        temperature: 0.3
                    })
                });
                const data = await response.json();
                document.getElementById(loadingId).innerHTML = `<div class="markdown-body text-zinc-200">${marked.parse(data.choices[0].message.content)}</div>`;
            } catch (e) { document.getElementById(loadingId).innerHTML = "é‡‘åº“è¿çº¿å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚"; }
        }

        function appendMessage(role, content) {
            const chatBox = document.getElementById('chat-box');
            const id = 'msg-' + Date.now();
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} mb-6`;
            div.innerHTML = `<div class="${role === 'user' ? 'bubble-user px-5 py-3' : 'bubble-ai p-6'} max-w-[95%] shadow-xl"><div id="${id}-content">${role==='assistant'?'<p class="text-yellow-500 font-bold mb-2">ğŸ¶ æ¥ç¦ç®¡å®¶æ±‡æŠ¥ï¼š</p>':''}${content}</div></div>`;
            chatBox.appendChild(div); chatBox.scrollTop = chatBox.scrollHeight;
            return role === 'assistant' ? id + '-content' : id;
        }

        window.addEventListener('resize', () => { camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
    </script>
</body>
</html>